set -o xtrace # print commands being executed

sudo docker stop postgres
sudo docker container rm -f postgres
sudo docker run --name postgres -p 5432:5432 -e POSTGRES_PASSWORD=test -e POSTGRES_USER=mindshub -d postgis/postgis
sleep 5
#& $($(echo "$(cargo tarpaulin --print-rust-flags --target-dir=target/tarpaulin)" | grep -v INFO)) cargo build
#$(cargo tarpaulin  --print-rust-flags | grep -v INFO)
#cargo tarpaulin --command build --skip-clean --target-dir=target/tarpaulin
#DATABASE_URL=
diesel database reset --database-url="postgres://mindshub:test@localhost:5432/insignorocketdb"

# terminate gracefully when the user uses Ctrl+C
if [[ $# -ne 1 ]]
then
    trap 'sudo docker stop postgres; sudo docker container rm -f postgres; exit' INT
fi
#cargo test -- --test-threads=1
cargo watch -s "cargo tarpaulin --target-dir=target/tarpaulin --skip-clean -- --test-threads=1"